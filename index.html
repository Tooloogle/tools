<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <title>Tooloogle Web Components</title>
    <link href="./demo/_style.css" rel="stylesheet" />
    <script src="demo/tools.js" type="module"></script>
    <script src="../node_modules/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>
    <script src="../node_modules/lit/polyfill-support.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        // darkMode: 'class',
        theme: {},
      };
    </script>
  </head>

  <body class="p-5 dark:bg-gray-800 dark:text-slate-400">
    <!-- Header with Logo and Search -->
    <header
      class="flex flex-col sm:flex-row items-center justify-between mb-8 gap-4 border-b dark:border-gray-500 pb-5"
    >
      <!-- Logo on the left -->
      <div class="flex-shrink-0">
        <img
          src="./src/_images/brand-logo.png"
          width="256"
          height="50"
          class="w-52 h-auto object-contain"
        />
      </div>

      <!-- Search box in center -->
      <div class="max-w-2xl ml-auto w-full">
        <div class="relative">
          <svg
            class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
            ></path>
          </svg>
          <input
            type="text"
            id="search-input"
            placeholder="Search and select a tool..."
            class="w-full pl-10 pr-10 py-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
          <svg
            id="clear-icon"
            class="absolute right-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400 cursor-pointer hover:text-gray-600 dark:hover:text-gray-200 hidden"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"
            ></path>
          </svg>
          <div
            id="dropdown"
            class="absolute z-10 w-full mt-2 bg-white dark:bg-gray-700 border dark:border-gray-600 rounded-lg shadow-lg max-h-96 overflow-y-auto hidden"
          >
            <div id="tools-list"></div>
          </div>
        </div>
      </div>

      <!-- Empty space for symmetry -->
      <!-- <div class="flex-shrink-0 w-24 hidden sm:block"></div> -->
    </header>

    <!-- Tool Container -->
    <div class="flex justify-center">
      <div id="container">
        <div
          id="demo-container"
          class="p-4 shadow dark:shadow-lg border-none dark:bg-gray-700 rounded"
        ></div>
      </div>
    </div>

    <script type="module">
      function initTool(tool) {
        let script = document.createElement('script');
        script.type = 'module';
        script.src = `dist/${tool}/${tool}.js`;
        const className =
          'lg:w-2/5 pr-4 pl-4 md:w-3/5 pr-4 pl-4 sm:w-2/3 pr-4 pl-4 w-full';
        if (
          [
            'qr-code-generator',
            'javascript-beautifier',
            'css-beautifier',
            'html-beautifier',
            'json-viewer',
            'csv-to-json-converter',
            'json-to-csv-converter',
            'regex-expression-tester',
            'stylish-text-generator',
          ].includes(tool)
        ) {
          document.getElementById('container').className = 'w-full';
        } else {
          document.getElementById('container').className = className;
        }

        script.onload = function () {
          document.getElementById(
            'demo-container'
          ).innerHTML = `<${tool}></${tool}>`;
          // Store the selected tool in localStorage
          localStorage.setItem('demo-selected-tool', tool);
        };

        script.onerror = function () {
          document.getElementById(
            'demo-container'
          ).innerHTML = `<p> ${tool} Not found.</p>`;
        };

        document.head.appendChild(script);
      }

      const searchInput = document.getElementById('search-input');
      const dropdown = document.getElementById('dropdown');
      const toolsList = document.getElementById('tools-list');
      const clearIcon = document.getElementById('clear-icon');

      function renderTools(filteredTools) {
        toolsList.innerHTML = '';
        filteredTools.forEach((t, i) => {
          const div = document.createElement('div');
          div.className =
            'px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 cursor-pointer capitalize';
          div.textContent = `${i + 1}. ${t.replace(/-/g, ' ')}`;
          div.onclick = () => {
            searchInput.value = t.replace(/-/g, ' ');
            dropdown.classList.add('hidden');
            clearIcon.classList.remove('hidden');
            initTool(t);
          };
          toolsList.appendChild(div);
        });
      }

      searchInput.addEventListener('focus', () => {
        dropdown.classList.remove('hidden');
        renderTools(tools);
      });

      searchInput.addEventListener('input', e => {
        const query = e.target.value.toLowerCase();
        const filtered = tools.filter(t =>
          t.replace(/-/g, ' ').toLowerCase().includes(query)
        );
        renderTools(filtered);
        dropdown.classList.remove('hidden');

        if (e.target.value) {
          clearIcon.classList.remove('hidden');
        } else {
          clearIcon.classList.add('hidden');
        }
      });

      clearIcon.addEventListener('click', () => {
        searchInput.value = '';
        clearIcon.classList.add('hidden');
        dropdown.classList.remove('hidden');
        renderTools(tools);
        searchInput.focus();
      });

      document.addEventListener('click', e => {
        if (!searchInput.contains(e.target) && !dropdown.contains(e.target)) {
          dropdown.classList.add('hidden');
        }
      });

      // Load last selected tool on page load
      const lastSelectedTool = localStorage.getItem('demo-selected-tool');
      if (lastSelectedTool && tools.includes(lastSelectedTool)) {
        // Set the search input to show the last selected tool
        searchInput.value = lastSelectedTool.replace(/-/g, ' ');
        clearIcon.classList.remove('hidden');
        initTool(lastSelectedTool);
      } else if (tools.length > 0) {
        // Load first tool if no previous selection
        initTool(tools[tools.length - 1]);
      }
    </script>
  </body>
</html>
